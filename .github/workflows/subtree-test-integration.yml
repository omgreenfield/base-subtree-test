name: Subtree test integration

on:
  push:
    branches: [ master ]

jobs:
  push-subtree-test-changes:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: Set GitHub config
      run: |
        - git config --global user.name "Matthew Greenfield"
        - git config --global user.email "mattgreenfield1@gmail.com"
    - name: auth github
      run: |
        mkdir ~/.ssh/
        ssh-keyscan github.com >> ~/.ssh/known_hosts
    - name: Push to subtree
      run: git subtree push --prefix subtree-test "https://omgreenfield:${{ secrets.PUSH_TOKEN }}@github.com/omgreenfield/subtree-test.git" "master"
    - name: Push to subtree2
      run: git subtree push --prefix subtree-test2 "https://omgreenfield:${{ secrets.PUSH_TOKEN }}@github.com/omgreenfield2/subtree-test2.git" "master"
